'use strict';
var $ = require('../internals/export');
<<<<<<< HEAD
=======
var call = require('../internals/function-call');
var uncurryThis = require('../internals/function-uncurry-this');
>>>>>>> working-dev
var aCallable = require('../internals/a-callable');
var getIterator = require('../internals/get-iterator');
var iterate = require('../internals/iterate');

<<<<<<< HEAD
=======
var push = uncurryThis([].push);

>>>>>>> working-dev
// `Map.groupBy` method
// https://github.com/tc39/proposal-collection-methods
$({ target: 'Map', stat: true }, {
  groupBy: function groupBy(iterable, keyDerivative) {
    aCallable(keyDerivative);
    var iterator = getIterator(iterable);
    var newMap = new this();
    var has = aCallable(newMap.has);
    var get = aCallable(newMap.get);
    var set = aCallable(newMap.set);
    iterate(iterator, function (element) {
      var derivedKey = keyDerivative(element);
<<<<<<< HEAD
      if (!has.call(newMap, derivedKey)) set.call(newMap, derivedKey, [element]);
      else get.call(newMap, derivedKey).push(element);
=======
      if (!call(has, newMap, derivedKey)) call(set, newMap, derivedKey, [element]);
      else push(call(get, newMap, derivedKey), element);
>>>>>>> working-dev
    }, { IS_ITERATOR: true });
    return newMap;
  }
});
